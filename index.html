<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Auto Video Loader</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- <link rel="stylesheet" href="css/styles.css"> -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <div class="avl-carousel-container">
      
      <div class="owl-carousel owl-theme">      
        <div class="item"><iframe id="itemframe1" width="100%" height="350" src="https://www.youtube.com/embed/6ZnfsJ6mM5c?rel=0&amp;showinfo=0&amp;enablejsapi=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>
        <div class="item"><iframe id="itemframe2" width="100%" height="350" src="https://www.youtube.com/embed/whZNYPldMEY?rel=0&amp;showinfo=0&amp;enablejsapi=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>
        <div class="item"><iframe id="itemframe3" width="100%" height="350" src="https://www.youtube.com/embed/KhzGSHNhnbI?rel=0&amp;showinfo=0&amp;enablejsapi=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>        
        <div class="item"><iframe id="itemframe4" width="100%" height="350" src="https://www.youtube.com/embed/bKWDKmHvF78?rel=0&amp;showinfo=0&amp;enablejsapi=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>
        <div class="item"><iframe id="itemframe5" width="100%" height="350" src="https://www.youtube.com/embed/T5iGAAypGBA?rel=0&amp;showinfo=0&amp;enablejsapi=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>
      </div>

      <div class="arrow next"></div>
      <div class="arrow prev"></div>
  
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script>

      //var iframes = ['itemframe1', 'itemframe2'];
      var iframes = ['itemframe1', 'itemframe2', 'itemframe3', 'itemframe4', 'itemframe5'];

      var owl = $('.owl-carousel');
       
      owl.owlCarousel({
        items:1,
        merge:true,
        loop:true,
        margin:10,
        video:true,
        lazyLoad:true,
        center:true,
        dots: false,
        responsive:{
          0:{
            items:1,
            nav:false
          },
          600:{
            items:3,
            nav:false
          }
        }
      });


      $('.next').click(function() {
        owl.trigger('next.owl.carousel');
      });

      $('.prev').click(function() {
        owl.trigger('prev.owl.carousel');
      });

      var tag = document.createElement('script');
      tag.id = 'iframe-demo';
      tag.src = 'https://www.youtube.com/iframe_api';
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      var player;
      function onYouTubeIframeAPIReady() {
        iframes.forEach(function(element) {
          player = new YT.Player(element, {
              events: {
                'onReady': onPlayerReady
              }
          });
        });
        
      }


      var navigate = {
        carousel : ['A', 'B', 'C', 'D'],
        current : 0,
        updateIndex : function(event){

          if(event == 'next'){
            this.current++;
          }else{
            this.current--;
          }
          this.current = this.correction(this.current);
          
          this.prev = this.correction(this.current - 1);
          this.next = this.correction(this.current + 1);

          this.setObj();
        },
        correction: function(val){
          if(val < 0){
            val = this.carouselCount;
          }

          if(val > this.carouselCount){
            val = 0;
          }
          return val;
        },
        init: function(obj){
          this.carousel = obj;
          this.carouselCount = this.carousel.length - 1;
          this.prev = this.correction(this.current - 1);
          this.next = this.correction(this.current + 1);
          this.setObj();

        },
        setObj: function(){
          this.prevObj = this.carousel[this.prev];
          this.currentObj = this.carousel[this.current];
          this.nextObj = this.carousel[this.next];
        },
        sampleConsole: function(){
          console.log(this.prevObj + ' ' + this.currentObj + ' ' + this.nextObj);
        }
      };

      
      
      var playerHandles = [];
      var i = 0;
      function onPlayerReady(event) {
        var id = event.target.a.id;
        id = parseInt(id.replace("itemframe", "")) - 1;
        console.log(typeof event.target);

        if(typeof event.target === 'object'){
          playerHandles[id] = event.target;
        }
         
        //playerHandles.push(event.target);
        console.log( i + ' : ' + id);
        i++;
        console.log("length " + playerHandles.length);

        if(typeof event.target === 'object' && playerHandles.length == 5){
          console.log("completed");
          console.log(playerHandles);
          navigate.init(playerHandles);
          navigate.currentObj.playVideo();

          $(".next").click(function(){
            navigate.currentObj.stopVideo();
            navigate.updateIndex('next');
            console.log(navigate.current);
            navigate.currentObj.playVideo();
          });

          $(".prev").click(function(){
            navigate.currentObj.stopVideo();
            navigate.updateIndex('prev');
            console.log(navigate.current);
            navigate.currentObj.playVideo();
          });

        }
        

      }


    </script>
  </body>
</html>